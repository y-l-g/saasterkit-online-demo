---
title: Full Example
description: A complete example of implementing Plans, Roles, and Permissions for a media generation application.
navigation:
    icon: i-lucide-file-code
---

This example demonstrates a robust and concise authorization setup for a media generation application, covering plans, team roles, implicit owner permissions, and context-aware backend validation.

### 1. Defining Plans & Features

We offer two plans: "Pro" for images and "Premium" for both images and videos.

```php [app/Enums/Teams/PlanEnum.php]
public function features(): array
{
    return match ($this) {
        self::PRO => [
            FeatureEnum::IMAGE,
        ],
        self::PREMIUM => [
            FeatureEnum::IMAGE,
            FeatureEnum::VIDEO,
        ],
    };
}
```

The corresponding features are defined in `FeatureEnum`.

```php [app/Enums/Teams/FeatureEnum.php]
enum FeatureEnum: string
{
    case IMAGE = 'image';
    case VIDEO = 'video';
}
```

### 2. Defining Roles & Permissions

We have roles like "Creator," who can create resources, and "Viewer," who can only view them. Deleting a video is implicitly an owner-only action because the `VIDEO_DELETE` permission is not assigned to any other role.

```php [app/Enums/Teams/RoleEnum.php]
public function permissions(): array
{
    return match ($this) {
        self::ADMIN => [
            TeamMemberPermissionEnum::IMAGE_VIEW,
            TeamMemberPermissionEnum::IMAGE_CREATE,
            TeamMemberPermissionEnum::VIDEO_VIEW,
            TeamMemberPermissionEnum::VIDEO_CREATE,
        ],
        self::CREATOR => [
            TeamMemberPermissionEnum::IMAGE_VIEW,
            TeamMemberPermissionEnum::IMAGE_CREATE,
            TeamMemberPermissionEnum::VIDEO_VIEW,
            TeamMemberPermissionEnum::VIDEO_CREATE,
        ],
        self::VIEWER => [
            TeamMemberPermissionEnum::IMAGE_VIEW,
            TeamMemberPermissionEnum::VIDEO_VIEW,
        ],
    };
}
```

Permissions are centralized in `TeamMemberPermissionEnum`.

```php [app/Enums/Teams/TeamMemberPermissionEnum.php]
enum TeamMemberPermissionEnum: string
{
    case IMAGE_VIEW = 'image.view';
    case IMAGE_CREATE = 'image.create';
    case VIDEO_VIEW = 'video.view';
    case VIDEO_CREATE = 'video.create';
    case VIDEO_DELETE = 'video.delete'; // Owner-only permission
}
```

### 3. Frontend Usage (Vue.js)

Use composables to conditionally render UI components based on the user's permissions within their currently active team.

**Generate a new image:**

```vue
<script setup lang="ts">
const { hasTeamPermission } = useTeamPermissions();
const { hasFeature } = useFeatures();
</script>
<template>
    <GenerateImageButton
        v-if="hasFeature('image') && hasTeamPermission('image.create')"
    />
</template>
```

**Generate a new video:**

```vue
<script setup lang="ts">
const { hasTeamPermission } = useTeamPermissions();
const { hasFeature } = useFeatures();
</script>
<template>
    <GenerateVideoButton
        v-if="hasFeature('video') && hasTeamPermission('video.create')"
    />
</template>
```

**Delete a video (Owner-only):**

```vue
<script setup lang="ts">
const { hasTeamPermission } = useTeamPermissions();
</script>
<template>
    <DeleteVideoButton v-if="hasTeamPermission('video.delete')" />
</template>
```

### 4. Backend Authorization (Form Requests)

Backend authorization doesn't depend on the user's `current_team`. It should validate against the specific team context of the request.

- For **creation** actions, the target team must be identified in the request, typically from a route parameter (e.g., `/teams/{team}/videos`).
- For **update/delete** actions, the team is derived from the resource being modified (e.g., `$video->team`).

This ensures that the `hasTeamPermission` check is performed in the correct context, verifying the user's role specifically for the team that is relevant to the action.

**Authorize Video Creation:**

This example assumes your route is defined as `POST /teams/{team}/videos`.

```php [app/Http/Requests/Videos/StoreVideoRequest.php]
public function authorize(): bool
{
    $team = $this->route('team');

    return Gate::allows(TeamMemberPermissionEnum::VIDEO_CREATE, $team)
           && Gate::allows(FeatureEnum::VIDEO, $team);
}
```

**Authorize Video Deletion:**

This example assumes your route is defined as `DELETE /videos/{video}`.

```php [app/Http/Requests/Videos/DeleteVideoRequest.php]
public function authorize(): bool
{
    $video = $this->route('video');
    $team = $video->team;

    // Checks permission against the team that owns the video
    return Gate::allows(TeamMemberPermissionEnum::VIDEO_DELETE, $team)
}
```
